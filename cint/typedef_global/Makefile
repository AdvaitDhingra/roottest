TEST_TARGETS += scopeTest scopeTest2
CLEAN_TARGETS += $(ALL_LIBRARIES) output? *Dict* *.log *_timestamp

ifeq ($(strip $(ROOTTEST_HOME)),)
	export ROOTTEST_HOME := $(shell expr $(CURDIR) : '\(.*/roottest/\)')
endif

include $(ROOTTEST_HOME)/scripts/Rules.mk


scopeTest : scopeTest_timestamp

scopeTest_timestamp : run.C myclbad.$(DllSuf)
	$(CMDECHO) $(CALLROOTEXE) -l -q -b run.C 2>&1 | grep -v Processing | $(RemoveLeadingDirs) | sed -e s/myclbad.so/mycl.so/ > output1 ; diff -wb good.output output1 && touch $@

myclbad.$(DllSuf) : badDict.$(ObjSuf)
	$(BuildFromObj)

badDict.C : mycl.C LinkDef.h
	$(CMDECHO) rootcint -f badDict.C -c -DBAD mycl.C LinkDef.h


scopeTest2 : scopeTest2_timestamp

scopeTest2_timestamp : run.C myclgood.$(DllSuf)
	$(CMDECHO) $(CALLROOTEXE) -l -q -b rungood.C 2>&1 | grep -v Processing | $(RemoveLeadingDirs) |sed -e s/myclgood.so/mycl.so\ / > output2 ; diff -wb good.output output2 && touch $@

myclgood.$(DllSuf) : goodDict.$(ObjSuf)
	$(BuildFromObj)

goodDict.C : mycl.C LinkDef.h
	$(CMDECHO) rootcint -f goodDict.C -c mycl.C LinkDef.h

